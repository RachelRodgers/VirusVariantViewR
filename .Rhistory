library("shiny")
library("DT")
library("stringr")
library("tidyverse")
GetVCF <- function(sample) {
# Read in and format VCF file for selected sample
variantSample <- paste0("../variants/", sample, "_variants.vcf")
vcfFile <- read.delim(variantSample,
comment.char = "#", # ignore VCF header lines
header = FALSE,
colClasses = "character") # suppress conversion of columns
vcfHeaders <- c("RefGenome", "Position", "ID", "Reference", "Alternative",
"Quality", "Filter", "Info", "Format", "Values")
names(vcfFile) <- vcfHeaders
# The last number in Values will be the allelic depth - unfiltered number of
#   reads supporting the reported allele(s)
vcfFileFormatted <- vcfFile %>%
mutate("AllelicDepth" = map_chr(.x = str_split(Values, pattern = ","),
.f = tail, n = 1)) %>%
select(-c("ID", "Filter", "Info", "Format", "Values"))
}
# Read in sample alignment count data, calculate percent MNV
readCounts <- read.delim("../alignment_counts.txt")
View(readCounts)
readCounts <- readCounts %>%
mutate("percent_MNV" = round(100*(primary_alignments/total_reads),
digits = 2))
View(readCounts)
665/67502
# Read in genome coverage count data, calculate avg. genome coverage
rawFiles <- list.files(path = "../sample_data/genome_coverage/",
pattern = "*_coverage.txt")
# Some constants for calculation/formatting avg. genome coverage:
genome_size <- 7383
# column names determined from documentation at
# https://bedtools.readthedocs.io/en/latest/content/tools/genomecov.html
columnNames <- c("chromosome", "depth", "number_of_bases",
"chromosome_size", "fraction_of_bases")
# Run calculation, store in genomeCovVec - will be combined with readCounts
genomeCovVec <- vector(mode = "integer", length = length(rawFiles))
for (i in 1:length(rawFiles)) {
currentFile <- rawFiles[i]
currentFileName <- as.vector(strsplit(currentFile, "_coverage.txt")[[1]])
currentData <- read.delim(paste0(rawFileDir, currentFile), header = FALSE,
col.names = columnNames)
currentData <- currentData %>%
dplyr::select(depth, number_of_bases) %>%
dplyr::mutate(product = depth * number_of_bases)
avg_cov <- round(sum(currentData$product)/genome_size,
digits = 0)
genomeCovVec[i] <- avg_cov
names(genomeCovVec)[i] <- currentFileName
}
# Add the average genome coverage numbers to the readCounts data
sampleData <- readCounts %>%
dplyr::mutate("avg_genome_cov" = genomeCovVec[sample])
genomeCovVec <- vector(mode = "integer", length = length(rawFiles))
for (i in 1:length(rawFiles)) {
currentFile <- rawFiles[i]
currentFileName <- as.vector(strsplit(currentFile, "_coverage.txt")[[1]])
currentData <- read.delim(paste0("../sample_data/genome_coverage/",
currentFile),
header = FALSE,
col.names = columnNames)
currentData <- currentData %>%
dplyr::select(depth, number_of_bases) %>%
dplyr::mutate(product = depth * number_of_bases)
avg_cov <- round(sum(currentData$product)/genome_size,
digits = 0)
genomeCovVec[i] <- avg_cov
names(genomeCovVec)[i] <- currentFileName
}
# Add the average genome coverage numbers to the readCounts data
sampleData <- readCounts %>%
dplyr::mutate("avg_genome_cov" = genomeCovVec[sample])
View(sampleData)
runApp()
?renderDataTable
runApp()
names(sampleData) <- c("Sample", "Total Reads", "% MNV", "Average Coverage")
runApp()
runApp()
library("shiny")
library("DT")
library("Gviz")
library("data.table")
library("tidyverse")
?DataTrack
runApp()
runApp()
?renderPlot
runApp()
runApp()
runApp()
runApp()
runApp()
PlotCoverage("Baldridge_10")
PlotCoverage <- function(sample) {
options(useChromosomeNames = FALSE)
bedgraphDT <- fread(paste0("../alignment_files/", sample, "_sorted.bedGraph"),
col.names = c("chromosome", "start", "end", "value"))
gtrack <- GenomeAxisTrack(fontize = 16, fontcolor = "black", col = "black")
dtrack <- DataTrack(range = bedgraphDT, genome = "ModCR6",
type = "histogram", name = "Coverage",
background.title = "slategrey", col.histogram = "grey28",
fontsize = 12)
}
PlotCoverage("Baldridge_10")
test <- PlotCoverage("Baldridge_10")
View(test)
PlotCoverage <- function(sample) {
options(useChromosomeNames = FALSE)
bedgraphDT <- fread(paste0("../alignment_files/", sample, "_sorted.bedGraph"),
col.names = c("chromosome", "start", "end", "value"))
gtrack <- GenomeAxisTrack(fontize = 16, fontcolor = "black", col = "black")
dtrack <- DataTrack(range = bedgraphDT, genome = "ModCR6",
type = "histogram", name = "Coverage",
background.title = "slategrey", col.histogram = "grey28",
fontsize = 12)
coveragePlot <- plotTracks(list(gtrack, dtrack))
}
PlotCoverage("Baldrdige_10")
PlotCoverage("Baldridge_10")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
?DataTrack
runApp()
runApp()
runApp()
runApp()
runApp()
View(sampleData)
runApp()
runApp()
sampleData[1, "Sample"]
as.character(sampleData[1, "Sample"])
sampleData$Sample <- as.character(sampleData$Sample)
sampleData[1, "Sample"]
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
?formatStyle
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
sampleData[1, "Sample"]
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
sampleData[1,1]
class(sampleData[1,1])
?updateTextInput
runApp()
runApp()
View(sampleData)
runApp()
runApp()
View(sampleData)
library("shiny")
library("DT")
library("Gviz")
library("data.table")
library("tidyverse")
options(shiny.sanitize.errors = FALSE)
options(ucscChromosomeNames = FALSE)
#----- Function Definitions -----#
GetVCF <- function(sample) {
# Read in and format VCF file for selected sample
variantSample <- paste0("../variants/", sample, "_variants.vcf")
vcfFile <- read.delim(variantSample,
comment.char = "#", # ignore VCF header lines
header = FALSE,
colClasses = "character") # suppress conversion of columns
vcfHeaders <- c("Refence Genome", "Position",
"ID", "Reference", "Alternative",
"Quality", "Filter", "Info", "Format", "Values")
names(vcfFile) <- vcfHeaders
# The last number in Values will be the allelic depth - unfiltered number of
#   reads supporting the reported allele(s)
vcfFileFormatted <- vcfFile %>%
mutate("Allelic Depth" = map_chr(.x = str_split(Values, pattern = ","),
.f = tail, n = 1)) %>%
select(-c("ID", "Filter", "Info", "Format", "Values"))
}
PlotCoverage <- function(sample) {
options(useChromosomeNames = FALSE)
bedgraphDT <- fread(paste0("../alignment_files/", sample, "_sorted.bedGraph"),
col.names = c("chromosome", "start", "end", "value"))
gtrack <- GenomeAxisTrack(fontsize = 20, fontcolor = "black", col = "black")
dtrack <- DataTrack(range = bedgraphDT, genome = "ModCR6",
type = "histogram", name = "Coverage",
background.title = "slategrey", col.histogram = "grey28",
fontsize = 20)
coveragePlot <- plotTracks(list(gtrack, dtrack))
}
#----- Set up Data Table for App -----#
# Read in sample alignment count data, calculate percent MNV
readCounts <- read.delim("../alignment_counts.txt")
readCounts <- readCounts %>%
mutate("percent_MNV" = round(100*(primary_alignments/total_reads),
digits = 2))
# Read in genome coverage count data, calculate avg. genome coverage
rawFiles <- list.files(path = "../sample_data/genome_coverage/",
pattern = "*_coverage.txt")
# Some constants for calculation/formatting avg. genome coverage:
genome_size <- 7383
# column names determined from documentation at
# https://bedtools.readthedocs.io/en/latest/content/tools/genomecov.html
columnNames <- c("chromosome", "depth", "number_of_bases",
"chromosome_size", "fraction_of_bases")
# Run calculation, store in genomeCovVec - will be combined with readCounts
genomeCovVec <- vector(mode = "integer", length = length(rawFiles))
for (i in 1:length(rawFiles)) {
currentFile <- rawFiles[i]
currentFileName <- as.vector(strsplit(currentFile, "_coverage.txt")[[1]])
currentData <- read.delim(paste0("../sample_data/genome_coverage/",
currentFile),
header = FALSE,
col.names = columnNames)
currentData <- currentData %>%
dplyr::select(depth, number_of_bases) %>%
dplyr::mutate(product = depth * number_of_bases)
avg_cov <- round(sum(currentData$product)/genome_size,
digits = 0)
genomeCovVec[i] <- avg_cov
names(genomeCovVec)[i] <- currentFileName
}
# Add the average genome coverage numbers to the readCounts data
sampleData <- readCounts %>%
dplyr::mutate("avg_genome_cov" = genomeCovVec[sample])
names(sampleData) <- c("Sample", "Total Reads", "Primary Alignments",
"% MNV", "Average Coverage")
sampleData$Sample <- as.character(sampleData$Sample)
View(sampleData)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
testVCFFile <- GetVCF("Baldridge_10")
View(testVCFFile)
# testing how to parse out the VCF file to get info for HighlightTrack
testVCFFile <- GetVCF("Baldrdige_1")
# testing how to parse out the VCF file to get info for HighlightTrack
testVCFFile <- GetVCF("Baldridge_1")
startVector <- as.charcter(testVCFFile$Position)
a
startVector <- as.character(testVCFFile$Position)
startVector <- as.numeric(testVCFFile$Position)
altAlleles <- as.numeric(testVCFFile$Alternative)
altAlleles <- as.character(testVCFFile$Alternative)
widthVector <- map_int(.x = altAlleles, .f = length)
length("ACCCATCACC")
n("ACCCATCACC")
nchar("ACCCATCACC")
widthVector <- map_int(.x = altAlleles, .f = nchar)
shiny::runApp()
testSubset <- subset(testVCFFile, testVCFFile[1, "Alternative"])
testSubset <- testVCFFile[1, "Alternative"]
runApp()
runApp()
whatsit <- testVCFFile[testVCFFile[["Alternative"]] == 690]
View(whatsit)
whatsit <- testVCFFile[testVCFFile[["Position"]] == 690]
subset(testVCFFile, testVCFFile$Position == 690)
firstSubset <- subset(testVCFFile, testVCFFile$Position == 690)
class(firstSubset)
View(firstSubset)
firstSubst$Alternative
firstSubset$Alternative
class(firstSubset$Alternative)
firstSubset[[,"Alternative"]]
firstSubset[,"Alternative"]
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
?renderDataTable
runApp()
runApp()
runApp()
?datatable
runApp()
runApp()
?datatable
runApp()
?verbatimTextOutput
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
?reactive
runApp()
runApp()
View(iris)
irisDF <- iris
list <- list(row = 1, column = 1, value = 5.1)
list$row
irisDF[list]
runApp()
test <- matrix(1,1)
View(test)
?matrix
matrix
test
test <- matrix(c(1,2,3,4))
test <- matrix(row = c(1,2,3,4), column = c(1,2))
test <- matrix(1:9, nrow = 3)
test2 <- matrix[, 1] + 1
test2 <- test[, 1] + 1
View(test2)
test[ , 1]
?apply
rebuilt <- cbind(test, test[, 2:3])
View(rebuilt)
test[ , 1] + 1
rebuilt <- cbind((test[ ,1] +1), test[ , 2:3]
)
View(rebuilt)
runApp()
runApp()
runApp()
test
test[,2] < 5
?subset
?`[`
runApp()
test[,2] < 5
test[test[,2] < 5]
test[test[,2] < 5, drop = FALSE]
test[test[,2] < 5,, drop = FALSE]
runApp()
runApp()
runApp()
runApp()
